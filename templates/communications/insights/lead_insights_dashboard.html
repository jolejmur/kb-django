{% extends 'base/base.html' %}
{% load static %}

{% block title %}Información de Leads{% endblock %}

{% block extra_css %}
<style>
    /* Colores inspirados en Fuse Angular Template */
    .gradient-bg-1 { background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); }
    .gradient-bg-2 { background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%); }
    .gradient-bg-3 { background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%); }
    .gradient-bg-4 { background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%); }
    .gradient-bg-5 { background: linear-gradient(135deg, #F44336 0%, #D32F2F 100%); }
    .gradient-bg-6 { background: linear-gradient(135deg, #607D8B 0%, #455A64 100%); }
    
    .metric-card {
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .metric-card:hover {
        transform: translateY(-10px) scale(1.02);
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }
    
    .chart-container {
        position: relative;
        height: 400px;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .pulse-animation {
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
        70% { box-shadow: 0 0 0 20px rgba(59, 130, 246, 0); }
        100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
    }
    
    .growth-indicator {
        display: inline-flex;
        align-items: center;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
    }
    
    .growth-positive { background: rgba(16, 185, 129, 0.2); color: #10b981; }
    .growth-negative { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
    
    .team-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
    }
    
    .team-card:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: translateY(-5px);
    }
    
    .executive-title {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 800;
        font-size: 2.5rem;
    }
    
    body {
        background: linear-gradient(135deg, #263238 0%, #37474F 50%, #263238 100%);
        min-height: 100vh;
    }
    
    .glass-panel {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(15px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 20px;
    }
    
    .neon-border {
        box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        border: 2px solid rgba(59, 130, 246, 0.5);
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen text-white">
    <!-- Header ejecutivo -->
    <div class="glass-panel p-8 mb-8 mx-4">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
            <div>
                <h1 class="executive-title mb-2">📊 Información de Leads</h1>
                <p class="text-blue-100 text-lg">Panel ejecutivo de información de leads y rendimiento comercial</p>
                <div class="flex items-center mt-2 text-sm text-blue-200">
                    <i class="fas fa-calendar-alt mr-2"></i>
                    <span>Actualizado: {{ "now"|date:"d/m/Y H:i" }}</span>
                    {% if user_team %}
                        <span class="mx-3">•</span>
                        <i class="fas fa-users mr-2"></i>
                        <span>Equipo: {{ user_team.name }}</span>
                    {% endif %}
                </div>
            </div>
            <div class="mt-4 lg:mt-0">
                <div class="flex space-x-4">
                    <button onclick="refreshDashboard()" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-xl transition-all">
                        <i id="refresh-icon" class="fas fa-sync-alt mr-2"></i>Actualizar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Par 1: Leads Hoy vs Ayer -->
    <div class="mx-4 mb-8">
        <div class="glass-panel p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white flex items-center">
                    <span class="text-2xl mr-3">🎯</span>
                    Leads: Hoy vs Ayer
                </h3>
                <div class="text-sm text-blue-200">
                    <i class="fas fa-calendar-day mr-1"></i>Comparación diaria
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Leads de Hoy -->
                <div class="text-center p-6 rounded-2xl bg-gradient-to-br from-blue-500/20 to-blue-700/20 border border-blue-500/30">
                    <div class="text-5xl mb-4">🎯</div>
                    <h4 class="text-3xl font-bold text-white mb-2">{{ leads_today }}</h4>
                    <p class="text-blue-200 text-lg font-medium mb-4">Leads Hoy</p>
                    <div class="text-sm text-blue-300">
                        <i class="fas fa-calendar-alt mr-2"></i>{{ today_date|date:"d/m/Y" }}
                    </div>
                </div>

                <!-- Leads de Ayer -->
                <div class="text-center p-6 rounded-2xl bg-gradient-to-br from-gray-500/20 to-gray-700/20 border border-gray-500/30">
                    <div class="text-5xl mb-4">📅</div>
                    <h4 class="text-3xl font-bold text-white mb-2">{{ leads_yesterday }}</h4>
                    <p class="text-gray-200 text-lg font-medium mb-4">Leads Ayer</p>
                    <div class="text-sm text-gray-300">
                        <i class="fas fa-calendar-alt mr-2"></i>{{ yesterday_date|date:"d/m/Y" }}
                    </div>
                </div>
            </div>

            <!-- Análisis de crecimiento -->
            <div class="mt-6 p-4 rounded-xl {% if daily_growth >= 0 %}bg-green-500/10 border border-green-500/20{% else %}bg-red-500/10 border border-red-500/20{% endif %}">
                <div class="flex items-center justify-center space-x-4">
                    <div class="flex items-center">
                        {% if daily_growth >= 0 %}
                            <div class="text-3xl mr-3">📈</div>
                            <div class="text-center">
                                <p class="text-green-400 font-bold text-2xl">+{{ daily_growth|floatformat:1 }}%</p>
                                <p class="text-green-300 text-sm">Crecimiento</p>
                            </div>
                        {% else %}
                            <div class="text-3xl mr-3">📉</div>
                            <div class="text-center">
                                <p class="text-red-400 font-bold text-2xl">{{ daily_growth|floatformat:1 }}%</p>
                                <p class="text-red-300 text-sm">Decrecimiento</p>
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="hidden md:block w-px h-12 {% if daily_growth >= 0 %}bg-green-500/20{% else %}bg-red-500/20{% endif %}"></div>
                    
                    <div class="text-center">
                        {% if leads_today > leads_yesterday %}
                            <p class="text-white text-lg font-medium">{{ leads_difference }} leads más que ayer</p>
                            <p class="text-green-300 text-sm">¡Excelente rendimiento!</p>
                        {% elif leads_today == leads_yesterday %}
                            <p class="text-white text-lg font-medium">Mismo rendimiento que ayer</p>
                            <p class="text-blue-300 text-sm">Rendimiento estable</p>
                        {% else %}
                            <p class="text-white text-lg font-medium">{{ leads_difference }} leads menos que ayer</p>
                            <p class="text-orange-300 text-sm">Oportunidad de mejora</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Par 2: Leads Esta Semana vs Semana Anterior -->
    <div class="mx-4 mb-8">
        <div class="glass-panel p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white flex items-center">
                    <span class="text-2xl mr-3">📈</span>
                    Leads: Esta Semana vs Semana Anterior
                </h3>
                <div class="text-sm text-blue-200">
                    <i class="fas fa-calendar-week mr-1"></i>Comparación semanal
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Leads Esta Semana -->
                <div class="text-center p-6 rounded-2xl bg-gradient-to-br from-orange-500/20 to-orange-700/20 border border-orange-500/30">
                    <div class="text-5xl mb-4">📈</div>
                    <h4 class="text-3xl font-bold text-white mb-2">{{ leads_this_week }}</h4>
                    <p class="text-orange-200 text-lg font-medium mb-4">Esta Semana</p>
                    <div class="text-sm text-orange-300">
                        <i class="fas fa-calendar-week mr-2"></i>Lunes 00:00h
                    </div>
                </div>

                <!-- Leads Semana Anterior -->
                <div class="text-center p-6 rounded-2xl bg-gradient-to-br from-purple-500/20 to-purple-700/20 border border-purple-500/30">
                    <div class="text-5xl mb-4">📅</div>
                    <h4 class="text-3xl font-bold text-white mb-2">{{ leads_last_week }}</h4>
                    <p class="text-purple-200 text-lg font-medium mb-4">Semana Anterior</p>
                    <div class="text-sm text-purple-300">
                        <i class="fas fa-calendar-week mr-2"></i>Semana pasada
                    </div>
                </div>
            </div>

            <!-- Análisis de crecimiento semanal -->
            <div class="mt-6 p-4 rounded-xl {% if weekly_growth >= 0 %}bg-green-500/10 border border-green-500/20{% else %}bg-red-500/10 border border-red-500/20{% endif %}">
                <div class="flex items-center justify-center space-x-4">
                    <div class="flex items-center">
                        {% if weekly_growth >= 0 %}
                            <div class="text-3xl mr-3">🚀</div>
                            <div class="text-center">
                                <p class="text-green-400 font-bold text-2xl">+{{ weekly_growth|floatformat:1 }}%</p>
                                <p class="text-green-300 text-sm">Crecimiento semanal</p>
                            </div>
                        {% else %}
                            <div class="text-3xl mr-3">📉</div>
                            <div class="text-center">
                                <p class="text-red-400 font-bold text-2xl">{{ weekly_growth|floatformat:1 }}%</p>
                                <p class="text-red-300 text-sm">Decrecimiento semanal</p>
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="hidden md:block w-px h-12 {% if weekly_growth >= 0 %}bg-green-500/20{% else %}bg-red-500/20{% endif %}"></div>
                    
                    <div class="text-center">
                        {% if leads_this_week > leads_last_week %}
                            <p class="text-white text-lg font-medium">{{ week_diff }} leads más que la semana pasada</p>
                            <p class="text-green-300 text-sm">¡Tendencia positiva!</p>
                        {% elif leads_this_week == leads_last_week %}
                            <p class="text-white text-lg font-medium">Mismo rendimiento semanal</p>
                            <p class="text-blue-300 text-sm">Rendimiento consistente</p>
                        {% else %}
                            <p class="text-white text-lg font-medium">{{ week_diff_abs }} leads menos que la semana pasada</p>
                            <p class="text-orange-300 text-sm">Revisar estrategia semanal</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Par 3: Leads Este Mes vs Mes Anterior -->
    <div class="mx-4 mb-8">
        <div class="glass-panel p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white flex items-center">
                    <span class="text-2xl mr-3">🚀</span>
                    Leads: Este Mes vs Mes Anterior
                </h3>
                <div class="text-sm text-blue-200">
                    <i class="fas fa-calendar mr-1"></i>Comparación mensual
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Leads Este Mes -->
                <div class="text-center p-6 rounded-2xl bg-gradient-to-br from-green-500/20 to-green-700/20 border border-green-500/30">
                    <div class="text-5xl mb-4">🚀</div>
                    <h4 class="text-3xl font-bold text-white mb-2">{{ leads_this_month }}</h4>
                    <p class="text-green-200 text-lg font-medium mb-4">Este Mes</p>
                    <div class="text-sm text-green-300">
                        <i class="fas fa-calendar mr-2"></i>{{ today_date|date:"M Y" }}
                    </div>
                </div>

                <!-- Leads Mes Anterior -->
                <div class="text-center p-6 rounded-2xl bg-gradient-to-br from-indigo-500/20 to-indigo-700/20 border border-indigo-500/30">
                    <div class="text-5xl mb-4">📅</div>
                    <h4 class="text-3xl font-bold text-white mb-2">{{ leads_previous_month }}</h4>
                    <p class="text-indigo-200 text-lg font-medium mb-4">Mes Anterior</p>
                    <div class="text-sm text-indigo-300">
                        <i class="fas fa-calendar mr-2"></i>Mes pasado
                    </div>
                </div>
            </div>

            <!-- Análisis de crecimiento mensual -->
            <div class="mt-6 p-4 rounded-xl {% if monthly_growth >= 0 %}bg-green-500/10 border border-green-500/20{% else %}bg-red-500/10 border border-red-500/20{% endif %}">
                <div class="flex items-center justify-center space-x-4">
                    <div class="flex items-center">
                        {% if monthly_growth >= 0 %}
                            <div class="text-3xl mr-3">🚀</div>
                            <div class="text-center">
                                <p class="text-green-400 font-bold text-2xl">+{{ monthly_growth|floatformat:1 }}%</p>
                                <p class="text-green-300 text-sm">Crecimiento mensual</p>
                            </div>
                        {% else %}
                            <div class="text-3xl mr-3">📉</div>
                            <div class="text-center">
                                <p class="text-red-400 font-bold text-2xl">{{ monthly_growth|floatformat:1 }}%</p>
                                <p class="text-red-300 text-sm">Decrecimiento mensual</p>
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="hidden md:block w-px h-12 {% if monthly_growth >= 0 %}bg-green-500/20{% else %}bg-red-500/20{% endif %}"></div>
                    
                    <div class="text-center">
                        {% if leads_this_month > leads_previous_month %}
                            <p class="text-white text-lg font-medium">{{ month_diff }} leads más que el mes pasado</p>
                            <p class="text-green-300 text-sm">¡Crecimiento sostenido!</p>
                        {% elif leads_this_month == leads_previous_month %}
                            <p class="text-white text-lg font-medium">Mismo rendimiento mensual</p>
                            <p class="text-blue-300 text-sm">Rendimiento estable</p>
                        {% else %}
                            <p class="text-white text-lg font-medium">{{ month_diff_abs }} leads menos que el mes pasado</p>
                            <p class="text-orange-300 text-sm">Revisar estrategia mensual</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Par 4: Asignación Manual a Vendedores - Últimos 7 Días -->
    <div class="mx-4 mb-8">
        <div class="glass-panel p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white flex items-center">
                    <span class="text-2xl mr-3">📋</span>
                    Asignación Manual a Vendedores - Últimos 7 Días
                </h3>
                <div class="text-sm text-blue-200">
                    <i class="fas fa-calendar-week mr-1"></i>Actividad semanal
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Leads Pendientes (Últimos 7 días) -->
                <div class="text-center p-6 rounded-2xl bg-gradient-to-br from-orange-500/20 to-orange-700/20 border border-orange-500/30">
                    <div class="text-5xl mb-4">⏳</div>
                    <h4 class="text-3xl font-bold text-white mb-2">{{ leads_pending_last_7_days }}</h4>
                    <p class="text-orange-200 text-lg font-medium mb-4">Pendientes Últimos 7 Días</p>
                    <div class="text-sm text-orange-300">
                        <i class="fas fa-user-plus mr-2"></i>Sin vendedor asignado
                    </div>
                </div>

                <!-- Leads Asignados (Últimos 7 días) -->
                <div class="text-center p-6 rounded-2xl bg-gradient-to-br from-green-500/20 to-green-700/20 border border-green-500/30">
                    <div class="text-5xl mb-4">👤</div>
                    <h4 class="text-3xl font-bold text-white mb-2">{{ leads_assigned_last_7_days }}</h4>
                    <p class="text-green-200 text-lg font-medium mb-4">Asignados Últimos 7 Días</p>
                    <div class="text-sm text-green-300">
                        <i class="fas fa-user-check mr-2"></i>Con vendedor específico
                    </div>
                </div>
            </div>

            <!-- Indicador de eficiencia semanal -->
            {% with total_7_days=leads_assigned_last_7_days|add:leads_pending_last_7_days %}
            {% with weekly_rate=leads_assigned_last_7_days|floatformat:0|add:0 %}
            {% if total_7_days > 0 %}
                {% with calculated_rate=leads_assigned_last_7_days|floatformat:0|floatformat:0 %}
                <div class="mt-6 p-4 rounded-xl {% if leads_assigned_last_7_days >= leads_pending_last_7_days %}bg-green-500/10 border border-green-500/20{% elif leads_pending_last_7_days <= 5 %}bg-yellow-500/10 border border-yellow-500/20{% else %}bg-red-500/10 border border-red-500/20{% endif %}">
                    <div class="flex items-center justify-center space-x-4">
                        <div class="flex items-center">
                            {% if leads_assigned_last_7_days >= leads_pending_last_7_days %}
                                <div class="text-3xl mr-3">🎯</div>
                                <div class="text-center">
                                    <p class="text-green-400 font-bold text-2xl">{{ leads_assigned_last_7_days }}</p>
                                    <p class="text-green-300 text-sm">Asignados en 7 días</p>
                                </div>
                            {% elif leads_pending_last_7_days <= 5 %}
                                <div class="text-3xl mr-3">⚠️</div>
                                <div class="text-center">
                                    <p class="text-yellow-400 font-bold text-2xl">{{ leads_pending_last_7_days }}</p>
                                    <p class="text-yellow-300 text-sm">Pendientes en 7 días</p>
                                </div>
                            {% else %}
                                <div class="text-3xl mr-3">🔴</div>
                                <div class="text-center">
                                    <p class="text-red-400 font-bold text-2xl">{{ leads_pending_last_7_days }}</p>
                                    <p class="text-red-300 text-sm">Pendientes en 7 días</p>
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="hidden md:block w-px h-12 {% if leads_assigned_last_7_days >= leads_pending_last_7_days %}bg-green-500/20{% elif leads_pending_last_7_days <= 5 %}bg-yellow-500/20{% else %}bg-red-500/20{% endif %}"></div>
                        
                        <div class="text-center">
                            {% if leads_pending_last_7_days == 0 %}
                                <p class="text-white text-lg font-medium">Todos asignados en la semana</p>
                                <p class="text-green-300 text-sm">¡Excelente gestión semanal!</p>
                            {% elif leads_pending_last_7_days <= 5 %}
                                <p class="text-white text-lg font-medium">{{ leads_pending_last_7_days }} pendientes en la semana</p>
                                <p class="text-yellow-300 text-sm">Pocos pendientes</p>
                            {% else %}
                                <p class="text-white text-lg font-medium">{{ leads_pending_last_7_days }} pendientes en la semana</p>
                                <p class="text-red-300 text-sm">Requiere atención</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endwith %}
            {% endif %}
            {% endwith %}
            {% endwith %}
        </div>
    </div>

    <!-- Gráficas principales -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8 mx-4">
        <!-- Evolución de Leads -->
        <div class="glass-panel p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white flex items-center">
                    <span class="text-2xl mr-3">📊</span>
                    Evolución de Leads (30 días)
                </h3>
                <div class="text-sm text-blue-200">
                    <i class="fas fa-chart-line mr-1"></i>Tendencia diaria
                </div>
            </div>
            <div class="chart-container">
                <canvas id="evolutionChart"></canvas>
            </div>
        </div>

        <!-- Distribución de Asignaciones -->
        <div class="glass-panel p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white flex items-center">
                    <span class="text-2xl mr-3">📊</span>
                    Distribución de Asignaciones
                </h3>
                <div class="text-sm text-blue-200">
                    <i class="fas fa-percentage mr-1"></i>{{ total_teams }} equipos activos
                </div>
            </div>
            <div class="chart-container">
                <canvas id="teamsChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Métricas de rendimiento -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 mx-4">
        <!-- Tasa de Asignación Manual (Últimas 48h) -->
        <div class="glass-panel p-6 text-center">
            <div class="text-3xl mb-3">🎯</div>
            <h3 class="text-2xl font-bold text-white mb-2">{{ manual_assignment_rate_48h|floatformat:1 }}%</h3>
            <p class="text-blue-200">Tasa Asignación Manual</p>
            <p class="text-xs text-blue-300 mb-3">(Últimas 48 horas)</p>
            <div class="mt-4 h-2 bg-gray-700 rounded-full overflow-hidden">
                <div class="h-full bg-gradient-to-r from-blue-400 to-purple-500" style="width: {{ manual_assignment_rate_48h }}%"></div>
            </div>
            <p class="text-xs text-gray-400 mt-2">{{ leads_assigned_48h }} asignados / {{ leads_pending_48h }} pendientes</p>
        </div>

        <!-- Tiempo Promedio de Asignación -->
        <div class="glass-panel p-6 text-center">
            <div class="text-3xl mb-3">⏱️</div>
            <h3 class="text-2xl font-bold text-white mb-2">{{ avg_assignment_time_display }}</h3>
            <p class="text-blue-200">Tiempo Promedio Asignación</p>
            <div class="mt-4 h-2 bg-gray-700 rounded-full overflow-hidden">
                <div class="h-full bg-gradient-to-r from-green-400 to-blue-500" style="width: {% if avg_assignment_time <= 15 %}100{% elif avg_assignment_time <= 30 %}70{% elif avg_assignment_time <= 60 %}40{% else %}20{% endif %}%"></div>
            </div>
            <p class="text-xs text-gray-400 mt-2">
                {% if avg_assignment_time <= 15 %}Excelente{% elif avg_assignment_time <= 30 %}Bueno{% elif avg_assignment_time <= 60 %}Regular{% else %}Mejorable{% endif %}
            </p>
        </div>

        <!-- Leads Pendientes Asignación Manual -->
        <div class="glass-panel p-6 text-center">
            <div class="text-3xl mb-3">⏳</div>
            <h3 class="text-2xl font-bold text-orange-400 mb-2">{{ leads_no_asignados }}</h3>
            <p class="text-blue-200">Pendientes Asignación a Vendedores</p>
            <div class="mt-4">
                {% if leads_no_asignados > 0 %}
                    <span class="px-3 py-1 bg-orange-500 bg-opacity-20 text-orange-300 rounded-full text-sm">
                        <i class="fas fa-user-plus mr-1"></i>Faltan vendedores
                    </span>
                {% else %}
                    <span class="px-3 py-1 bg-green-500 bg-opacity-20 text-green-300 rounded-full text-sm">
                        <i class="fas fa-check mr-1"></i>Todos asignados
                    </span>
                {% endif %}
            </div>
        </div>

    </div>

    <!-- Distribución por horarios y canales -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8 mx-4">
        <!-- Leads por Hora -->
        <div class="glass-panel p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white flex items-center">
                    <span class="text-2xl mr-3">🕐</span>
                    Actividad por Hora (7 días)
                </h3>
                <div class="text-sm text-blue-200">
                    <i class="fas fa-clock mr-1"></i>Patrón horario
                </div>
            </div>
            <div class="chart-container">
                <canvas id="hourlyChart"></canvas>
            </div>
        </div>

        <!-- Distribución por Canal -->
        <div class="glass-panel p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white flex items-center">
                    <span class="text-2xl mr-3">📱</span>
                    Distribución por Canal
                </h3>
                <div class="text-sm text-blue-200">
                    <i class="fas fa-share-alt mr-1"></i>Origen de leads
                </div>
            </div>
            <div class="chart-container">
                <canvas id="channelChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Performance detallado por equipos -->
    {% if team_performance %}
    <div class="glass-panel p-6 mb-8 mx-4">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-bold text-white flex items-center">
                <span class="text-2xl mr-3">🏅</span>
                Ranking de Equipos de Ventas
            </h3>
            <div class="text-sm text-blue-200">
                <i class="fas fa-trophy mr-1"></i>Performance detallada
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for team_data in team_performance %}
            <div class="team-card rounded-xl p-6">
                <div class="flex items-center justify-between mb-4">
                    <h4 class="font-bold text-white text-lg">{{ team_data.team.name }}</h4>
                    <div class="w-4 h-4 rounded-full" style="background-color: {{ team_data.color }}"></div>
                </div>
                
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-300">Total Leads:</span>
                        <span class="font-bold text-white text-xl">{{ team_data.total_leads }}</span>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <span class="text-gray-300">Hoy:</span>
                        <span class="font-bold text-blue-400 text-lg">{{ team_data.leads_today }}</span>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <span class="text-gray-300">Esta Semana:</span>
                        <span class="font-bold text-green-400 text-lg">{{ team_data.leads_week }}</span>
                    </div>
                </div>
                
                <!-- Barra de progreso basada en leads de la semana -->
                <div class="mt-6">
                    <div class="text-center mb-2">
                        <span class="text-xs text-gray-400">Actividad Semanal</span>
                    </div>
                    <div class="h-3 bg-gray-700 rounded-full overflow-hidden">
                        <div class="h-full transition-all duration-1000" 
                             style="background: linear-gradient(90deg, {{ team_data.color }}, {{ team_data.color }}80); width: {% if team_data.leads_week > 0 %}{{ team_data.leads_week|add:0|floatformat:0 }}{% else %}5{% endif %}%">
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Footer con actualización automática -->
    <div class="glass-panel p-4 mx-4 mb-4 text-center">
        <p class="text-blue-200 text-sm">
            <i class="fas fa-sync-alt mr-2"></i>
            Dashboard actualizado automáticamente cada 5 minutos
            <span class="mx-2">•</span>
            <i class="fas fa-shield-alt mr-1"></i>
            Datos en tiempo real protegidos
        </p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

<script>
// Configuración global de Chart.js para el tema oscuro
Chart.defaults.color = '#e5e7eb';
Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.1)';
Chart.defaults.backgroundColor = 'rgba(255, 255, 255, 0.05)';

document.addEventListener('DOMContentLoaded', function() {
    // Datos del backend
    const evolutionData = {{ evolution_data|safe }};
    const hourlyData = {{ hourly_data|safe }};
    const channelData = {{ channel_data|safe }};
    const teamNames = {{ team_names|safe }};
    const teamLeads = {{ team_leads|safe }};
    const teamColors = {{ team_colors|safe }};

    // Gráfica de evolución de leads
    const evolutionCtx = document.getElementById('evolutionChart').getContext('2d');
    new Chart(evolutionCtx, {
        type: 'line',
        data: {
            labels: Object.keys(evolutionData).map(date => {
                const d = new Date(date);
                return d.toLocaleDateString('es-ES', { month: 'short', day: 'numeric' });
            }),
            datasets: [{
                label: 'Leads por día',
                data: Object.values(evolutionData),
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                fill: true,
                tension: 0.4,
                pointBackgroundColor: '#3b82f6',
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2,
                pointRadius: 6,
                pointHoverRadius: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                    ticks: { color: '#e5e7eb' }
                },
                x: {
                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                    ticks: { color: '#e5e7eb' }
                }
            },
            elements: {
                point: {
                    hoverBackgroundColor: '#60a5fa'
                }
            }
        }
    });

    // Gráfica de equipos
    if (teamNames.length > 0) {
        const teamsCtx = document.getElementById('teamsChart').getContext('2d');
        new Chart(teamsCtx, {
            type: 'doughnut',
            data: {
                labels: teamNames,
                datasets: [{
                    data: teamLeads,
                    backgroundColor: teamColors,
                    borderWidth: 3,
                    borderColor: 'rgba(255, 255, 255, 0.2)',
                    hoverBorderWidth: 5,
                    hoverBorderColor: '#ffffff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: '#e5e7eb',
                            usePointStyle: true,
                            padding: 20
                        }
                    }
                },
                cutout: '60%'
            }
        });
    }

    // Gráfica horaria
    const hourlyCtx = document.getElementById('hourlyChart').getContext('2d');
    new Chart(hourlyCtx, {
        type: 'bar',
        data: {
            labels: Object.keys(hourlyData).map(hour => `${hour}:00`),
            datasets: [{
                label: 'Leads por hora',
                data: Object.values(hourlyData),
                backgroundColor: 'rgba(34, 197, 94, 0.7)',
                borderColor: '#22c55e',
                borderWidth: 2,
                borderRadius: 8,
                borderSkipped: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                    ticks: { color: '#e5e7eb' }
                },
                x: {
                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                    ticks: { color: '#e5e7eb' }
                }
            }
        }
    });

    // Gráfica de canales
    if (channelData.length > 0) {
        const channelCtx = document.getElementById('channelChart').getContext('2d');
        new Chart(channelCtx, {
            type: 'pie',
            data: {
                labels: channelData.map(item => item.origen || 'Sin especificar'),
                datasets: [{
                    data: channelData.map(item => item.count),
                    backgroundColor: [
                        '#ef4444', '#f97316', '#eab308', '#22c55e', 
                        '#06b6d4', '#3b82f6', '#8b5cf6', '#ec4899'
                    ],
                    borderWidth: 3,
                    borderColor: 'rgba(255, 255, 255, 0.2)'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            color: '#e5e7eb',
                            usePointStyle: true,
                            padding: 15
                        }
                    }
                }
            }
        });
    }

    // Función para actualizar dashboard con efecto visual
    window.refreshDashboard = function() {
        const refreshIcon = document.getElementById('refresh-icon');
        refreshIcon.classList.add('fa-spin');
        
        // Recargar página después de mostrar animación
        setTimeout(() => {
            window.location.reload();
        }, 300);
    };

    // Auto-refresh cada 5 minutos
    setInterval(() => {
        console.log('🔄 Actualizando dashboard...');
        // Aquí se podría implementar actualización AJAX
        // window.location.reload();
    }, 300000);

    // Animaciones al scroll
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    });

    document.querySelectorAll('.metric-card, .glass-panel').forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(30px)';
        el.style.transition = 'all 0.8s ease';
        observer.observe(el);
    });
});
</script>
{% endblock %}